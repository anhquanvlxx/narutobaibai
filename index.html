<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width,initial-scale=1.0">
    <title>NARUTO SHIPPUDEN</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700&display=swap" rel="stylesheet">
    <style>
        /* BASE STYLES & FONT */
        body { font-family: 'Orbitron', sans-serif; background: #0d0d0d; color: #e0e0e0; display: flex; align-items: center; justify-content: center; min-height: 100vh; padding: 1rem; position: relative; overflow: hidden; }

        /* FIREFLIES EFFECT */
        .fireflies-container {
            position: fixed;
            top: 0; left: 0;
            width: 100%; height: 100%;
            z-index: 0;
            pointer-events: none;
        }

        .firefly {
            position: absolute;
            background: rgba(255, 255, 255, 0.2);
            border-radius: 50%;
            box-shadow: 0 0 10px 5px rgba(255, 0, 0, 0.5), 0 0 20px 10px rgba(255, 0, 0, 0.2);
            animation: firefly-move 10s infinite ease-in-out, firefly-glow 2s infinite ease-in-out;
        }

        .firefly:nth-child(2n) {
            box-shadow: 0 0 8px 4px rgba(255, 255, 255, 0.3), 0 0 15px 8px rgba(255, 255, 255, 0.1);
            animation-duration: 12s;
            animation-delay: -2s;
        }

        @keyframes firefly-move {
            0%, 100% { transform: translate(0, 0); }
            25% { transform: translate(15vw, -10vh); }
            50% { transform: translate(5vw, 15vh); }
            75% { transform: translate(-10vw, -5vh); }
        }

        @keyframes firefly-glow {
            0%, 100% { opacity: 0.8; }
            50% { opacity: 0.2; }
        }

        /* KEY PANEL STYLES */
        .panel-bg { position: relative; background: #1a1a1a; border: 2px solid #333333; border-radius: 2rem 2rem 0 2rem; box-shadow: 0 8px 30px rgba(0, 0, 0, 0.5); transition: transform 0.3s ease-in-out, opacity 0.3s ease-in-out; margin-bottom: 80px; z-index: 10; }
        .panel-bg::after { content: ''; position: absolute; bottom: -15px; left: 20px; width: 30px; height: 30px; background: #1a1a1a; transform: rotate(45deg); z-index: -1; box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2); border-bottom-right-radius: 5px; }

        .main-button { background: linear-gradient(135deg, #ff0000, #b30000); transition: all 0.3s ease; box-shadow: 0 4px 15px rgba(255, 0, 0, 0.3); }
        .main-button:hover:not(:disabled) { background: linear-gradient(135deg, #ff3333, #e60000); box-shadow: 0 0 20px rgba(255, 0, 0, 0.6); }
        .main-button:disabled { background: #333; cursor: not-allowed; color: #999; }
        
        .feature-card { background: #282828; border-radius: 1rem; box-shadow: 0 4px 15px rgba(0, 0, 0, 0.3); border: 1px solid #333333; }
        
        .loading-spinner { border: 4px solid rgba(255, 255, 255, 0.3); border-top: 4px solid #fff; border-radius: 50%; width: 24px; height: 24px; animation: spin 1s linear infinite; }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
        
        .message-box { position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%); background-color: #1a1a1a; padding: 2rem; border-radius: 1rem; box-shadow: 0 0 20px rgba(255, 0, 0, 0.5); z-index: 1000; text-align: center; }
        .overlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0, 0, 0, 0.7); z-index: 999; }
        .menu-closed { display: none; }
        
        .bottom-nav { position: fixed; bottom: 0; left: 0; width: 100%; background-color: #1a1a1a; padding: 0.5rem 0; display: flex; justify-content: space-around; align-items: center; border-top: 1px solid #333333; z-index: 900; }
        .bottom-nav button { background-color: transparent; border: none; color: #e0e0e0; padding: 0.75rem 1rem; font-size: 0.875rem; font-weight: bold; transition: color 0.2s; cursor: pointer; }
        .bottom-nav button:hover { color: #ff0000; }
        
        .naruto-logo { width: auto; height: 60px; margin: 0 auto 0.5rem auto; }

        /* KEY PANEL 3D & GLOWING EFFECTS */
        .key-input-container { position: relative; }
        .key-input { border: 2px solid transparent; background-clip: padding-box; transition: all 0.5s ease; }
        .key-input:focus { background: #1a1a1a; border-color: #ff0000; box-shadow: 0 0 10px rgba(255, 0, 0, 0.5); }
        .key-input-glow { position: absolute; inset: -2px; border-radius: 9999px; background: linear-gradient(45deg, #ff0000, #ff6666, #ff0000); z-index: -1; animation: pulse 2s infinite; opacity: 0; transition: opacity 0.5s ease; filter: blur(4px); }
        .key-input-container:focus-within .key-input-glow { opacity: 1; }
        @keyframes pulse { 0% { transform: scale(1); } 50% { transform: scale(1.05); } 100% { transform: scale(1); } }
        
        .submit-button-container { position: relative; }
        .submit-button { transition: transform 0.3s ease, box-shadow 0.3s ease; }
        .submit-button:hover:not(:disabled) { transform: translateY(-5px); box-shadow: 0 10px 25px rgba(255, 0, 0, 0.5); }
        
        .status-success { color: #2ecc71; animation: fadeInUp 0.5s ease; }
        .status-error { color: #e74c3c; animation: shake 0.5s ease; }
        @keyframes fadeInUp { from { opacity: 0; transform: translateY(20px); } to { opacity: 1; transform: translateY(0); } }
        @keyframes shake { 0%, 100% { transform: translateX(0); } 10%, 30%, 50%, 70%, 90% { transform: translateX(-5px); } 20%, 40%, 60%, 80% { transform: translateX(5px); } }

        #message-box { opacity: 0; transform: translate(-50%, -50%) scale(0.8); transition: all 0.3s ease-in-out; }
        #message-box.show { opacity: 1; transform: translate(-50%, -50%) scale(1); }
    </style>
</head>
<body class="flex flex-col items-center justify-center min-h-screen p-4">
    <div class="fireflies-container">
        <span class="firefly" style="top: 20%; left: 10%; width: 5px; height: 5px; animation-delay: 0s;"></span>
        <span class="firefly" style="top: 50%; left: 80%; width: 8px; height: 8px; animation-delay: -3s;"></span>
        <span class="firefly" style="top: 70%; left: 30%; width: 6px; height: 6px; animation-delay: -5s;"></span>
        <span class="firefly" style="top: 10%; left: 60%; width: 7px; height: 7px; animation-delay: -7s;"></span>
        <span class="firefly" style="top: 90%; left: 40%; width: 5px; height: 5px; animation-delay: -9s;"></span>
        <span class="firefly" style="top: 30%; left: 90%; width: 9px; height: 9px; animation-delay: -11s;"></span>
        <span class="firefly" style="top: 60%; left: 20%; width: 6px; height: 6px; animation-delay: -13s;"></span>
    </div>
    
    <div id="message-box" class="fixed top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 bg-[#1a1a1a] p-8 rounded-2xl shadow-xl z-[1000] text-center hidden">
        <p id="message-text" class="text-lg mb-4 text-white"></p>
        <button id="close-message" class="main-button text-white font-bold py-2 px-6 rounded-full">Đóng</button>
    </div>
    <div id="overlay" class="hidden fixed inset-0 bg-black bg-opacity-70 z-[999]"></div>

    <div id="key-panel" class="panel-bg rounded-3xl p-6 w-full max-w-lg">
        <div class="text-center mb-8">
            <h1 class="text-3xl md:text-4xl font-bold text-transparent bg-clip-text bg-gradient-to-r from-red-400 to-red-600">
                Nhập Key
            </h1>
            <p class="text-gray-400 text-sm mt-2">Vui lòng nhập key để truy cập</p>
        </div>
        <div class="space-y-4">
            <div class="key-input-container">
                <input type="text" id="key-input" placeholder="Nhập key của bạn" class="key-input w-full px-4 py-3 rounded-full bg-[#1a1a1a] border border-[#333333] text-white placeholder-gray-500 text-center focus:outline-none focus:ring-2 focus:ring-red-500">
                <div class="key-input-glow"></div>
            </div>
            <div class="submit-button-container">
                <button id="submit-key-button" class="submit-button main-button text-white font-extrabold w-full py-4 rounded-full flex items-center justify-center space-x-2">
                    <span id="key-button-text" class="text-lg">Kích hoạt</span>
                    <div id="key-loading-spinner" class="loading-spinner hidden"></div>
                </button>
            </div>
            <p id="key-status-message" class="text-center text-sm mt-2"></p>
        </div>

        <div class="flex justify-center mt-6 space-x-6">
            <a href="https://www.facebook.com/share/1DSGU8D2zX/?mibextid=wwXIfr" target="_blank" class="transform hover:scale-110 transition-transform duration-300">
                <img src="https://i.postimg.cc/qMmrZDHz/IMG-2479.png" alt="Facebook" class="h-10 w-10">
            </a>
            <a href="https://zalo.me/0899035561" target="_blank" class="transform hover:scale-110 transition-transform duration-300">
                <img src="https://i.postimg.cc/Vk6ffQWq/IMG-2478.webp" alt="Zalo" class="h-10 w-10">
            </a>
            <a href="https://t.me/rice7788" target="_blank" class="transform hover:scale-110 transition-transform duration-300">
                <img src="https://upload.wikimedia.org/wikipedia/commons/thumb/8/82/Telegram_logo.svg/1200px-Telegram_logo.svg.png" alt="Telegram" class="h-10 w-10">
            </a>
        </div>
    </div>

    <div id="main-panel" class="panel-bg rounded-3xl p-6 w-full max-w-lg hidden">
        <div class="text-center mb-8">
            <img src="https://i.postimg.cc/4NFC1Kpc/IMG-2417.jpg" alt="Naruto Shippuden Logo" class="naruto-logo">
            <h1 class="text-3xl md:text-4xl font-bold text-transparent bg-clip-text bg-gradient-to-r from-red-400 to-red-600">
                NARUTO SHIPPUDEN
            </h1>
            <p class="text-gray-400 text-sm mt-2">PANNEL CỦA NARUTO SHIPPUDEN</p>
        </div>

        <div class="mb-8 p-4 bg-[#282828] rounded-2xl border border-[#333333] text-center">
            <h2 class="text-xl font-semibold mb-4 text-red-300">Khởi chạy game</h2>
            <div class="flex items-center justify-center space-x-4 mb-4">
                <img id="game-icon" src="https://i.postimg.cc/N0LYBt0W/IMG-2291.jpg" alt="Logo Garena Free Fire" class="h-10 w-10 md:h-12 md:w-12 rounded-lg transform hover:scale-110 transition-transform duration-300">
            </div>
            <button id="open-game-button" class="main-button text-white font-extrabold w-full py-4 rounded-full flex items-center justify-center space-x-2">
                <span id="button-text" class="text-lg">Tối ưu</span>
                <div id="loading-spinner" class="loading-spinner hidden"></div>
            </button>
        </div>

        <div class="mb-8 p-4 bg-[#282828] rounded-2xl border border-[#333333] space-y-3">
            <p class="text-gray-300 flex justify-between items-center">
                <span class="font-medium">Thiết Bị:</span>
                <span id="device-info" class="text-sm text-red-300 font-bold">...</span>
            </p>
            <p class="text-gray-300 flex justify-between items-center">
                <span class="font-medium">UID:</span>
                <span id="uid-info" class="text-sm text-red-300 font-bold">...</span>
            </p>
            <p class="text-gray-300 flex justify-between items-center">
                <span class="font-medium">Pin:</span>
                <span id="battery-info" class="text-sm text-red-300 font-bold">...</span>
            </p>
            <p class="text-gray-300 flex justify-between items-center">
                <span class="font-medium">Thời gian còn lại:</span>
                <span id="key-expiry-info" class="text-sm text-red-300 font-bold">...</span>
            </p>
            <p class="text-gray-300 flex justify-between items-center">
                <span class="font-medium">FPS:</span>
                <span id="fps-value" class="text-sm text-red-300 font-bold">...</span>
            </p>
        </div>
        
        <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mb-8">
            <div class="feature-card p-4 space-y-4">
                <div class="flex justify-between items-center">
                    <div class="flex items-center">
                        <span class="feature-icon">🚀</span>
                        <span>FPS BOOSTER</span>
                    </div>
                    <label class="relative inline-flex items-center cursor-pointer">
                        <input type="checkbox" class="sr-only peer toggle-feature" data-feature-name="FPS Booster">
                        <div class="w-12 h-6 rounded-full peer toggle-switch-bg checked:bg-red-500 peer-focus:ring-2 peer-focus:ring-red-300 after:absolute after:top-1 after:left-1 after:bg-white after:border-gray-300 after:border after:rounded-full after:h-4 after:w-4 after:transition-all peer-checked:after:translate-x-full"></div>
                    </label>
                </div>
                <div class="flex justify-between items-center">
                    <div class="flex items-center">
                        <span class="feature-icon">⚙️</span>
                        <span>PERFORMANCE OPTIMIZER</span>
                    </div>
                    <label class="relative inline-flex items-center cursor-pointer">
                        <input type="checkbox" class="sr-only peer toggle-feature" data-feature-name="Performance Optimizer">
                        <div class="w-12 h-6 rounded-full peer toggle-switch-bg checked:bg-red-500 peer-focus:ring-2 peer-focus:ring-red-300 after:absolute after:top-1 after:left-1 after:bg-white after:border-gray-300 after:border after:rounded-full after:h-4 after:w-4 after:transition-all peer-checked:after:translate-x-full"></div>
                    </label>
                </div>
                <div class="flex justify-between items-center">
                    <div class="flex items-center">
                        <span class="feature-icon">🎮</span>
                        <span>GAME MODE</span>
                    </div>
                    <label class="relative inline-flex items-center cursor-pointer">
                        <input type="checkbox" class="sr-only peer toggle-feature" data-feature-name="Game Mode">
                        <div class="w-12 h-6 rounded-full peer toggle-switch-bg checked:bg-red-500 peer-focus:ring-2 peer-focus:ring-red-300 after:absolute after:top-1 after:left-1 after:bg-white after:border-gray-300 after:border after:rounded-full after:h-4 after:w-4 after:transition-all peer-checked:after:translate-x-full"></div>
                    </label>
                </div>
            </div>

            <div class="feature-card p-4 space-y-4">
                <div class="flex justify-between items-center">
                    <div class="flex items-center">
                        <span class="feature-icon">🎯</span>
                        <span>AIMLOCK</span>
                    </div>
                    <label class="relative inline-flex items-center cursor-pointer">
                        <input type="checkbox" class="sr-only peer toggle-feature" data-feature-name="Aimlock">
                        <div class="w-12 h-6 rounded-full peer toggle-switch-bg checked:bg-red-500 peer-focus:ring-2 peer-focus:ring-red-300 after:absolute after:top-1 after:left-1 after:bg-white after:border-gray-300 after:border after:rounded-full after:h-4 after:w-4 after:transition-all peer-checked:after:translate-x-full"></div>
                    </label>
                </div>
                <div class="flex justify-between items-center">
                    <div class="flex items-center">
                        <span class="feature-icon">🔒</span>
                        <span>HEADLOCK</span>
                    </div>
                    <label class="relative inline-flex items-center cursor-pointer">
                        <input type="checkbox" class="sr-only peer toggle-feature" data-feature-name="Headlock">
                        <div class="w-12 h-6 rounded-full peer toggle-switch-bg checked:bg-red-500 peer-focus:ring-2 peer-focus:ring-red-300 after:absolute after:top-1 after:left-1 after:bg-white after:border-gray-300 after:border after:rounded-full after:h-4 after:w-4 after:transition-all peer-checked:after:translate-x-full"></div>
                    </label>
                </div>
                <div class="flex justify-between items-center">
                    <div class="flex items-center">
                        <span class="feature-icon">✨</span>
                        <span>SUPERLOCK</span>
                    </div>
                    <label class="relative inline-flex items-center cursor-pointer">
                        <input type="checkbox" class="sr-only peer toggle-feature" data-feature-name="Superlock">
                        <div class="w-12 h-6 rounded-full peer toggle-switch-bg checked:bg-red-500 peer-focus:ring-2 peer-focus:ring-red-300 after:absolute after:top-1 after:left-1 after:bg-white after:border-gray-300 after:border after:rounded-full after:h-4 after:w-4 after:transition-all peer-checked:after:translate-x-full"></div>
                    </label>
                </div>
            </div>
            
            <div class="feature-card p-4 space-y-4">
                <div class="flex justify-between items-center">
                    <div class="flex items-center">
                        <span class="feature-icon">🏎️</span>
                        <span>TURBO BOOST</span>
                    </div>
                    <label class="relative inline-flex items-center cursor-pointer">
                        <input type="checkbox" class="sr-only peer toggle-feature" data-feature-name="Turbo Boost">
                        <div class="w-12 h-6 rounded-full peer toggle-switch-bg checked:bg-red-500 peer-focus:ring-2 peer-focus:ring-red-300 after:absolute after:top-1 after:left-1 after:bg-white after:border-gray-300 after:border after:rounded-full after:h-4 after:w-4 after:transition-all peer-checked:after:translate-x-full"></div>
                    </label>
                </div>
                <div class="flex justify-between items-center">
                    <div class="flex items-center">
                        <span class="feature-icon">⚡</span>
                        <span>LAG FIXER</span>
                    </div>
                    <label class="relative inline-flex items-center cursor-pointer">
                        <input type="checkbox" class="sr-only peer toggle-feature" data-feature-name="Lag Fixer">
                        <div class="w-12 h-6 rounded-full peer toggle-switch-bg checked:bg-red-500 peer-focus:ring-2 peer-focus:ring-red-300 after:absolute after:top-1 after:left-1 after:bg-white after:border-gray-300 after:border after:rounded-full after:h-4 after:w-4 after:transition-all peer-checked:after:translate-x-full"></div>
                    </label>
                </div>
                <div class="flex justify-between items-center">
                    <div class="flex items-center">
                        <span class="feature-icon">🌟</span>
                        <span>SMOOTH PLAY</span>
                    </div>
                    <label class="relative inline-flex items-center cursor-pointer">
                        <input type="checkbox" class="sr-only peer toggle-feature" data-feature-name="Smooth Play">
                        <div class="w-12 h-6 rounded-full peer toggle-switch-bg checked:bg-red-500 peer-focus:ring-2 peer-focus:ring-red-300 after:absolute after:top-1 after:left-1 after:bg-white after:border-gray-300 after:border after:rounded-full after:h-4 after:w-4 after:transition-all peer-checked:after:translate-x-full"></div>
                    </label>
                </div>
            </div>

            <div class="feature-card p-4 space-y-4">
                <div class="flex justify-between items-center">
                    <div class="flex items-center">
                        <span class="feature-icon">🖼️</span>
                        <span>FAST RENDER</span>
                    </div>
                    <label class="relative inline-flex items-center cursor-pointer">
                        <input type="checkbox" class="sr-only peer toggle-feature" data-feature-name="Fast Render">
                        <div class="w-12 h-6 rounded-full peer toggle-switch-bg checked:bg-red-500 peer-focus:ring-2 peer-focus:ring-red-300 after:absolute after:top-1 after:left-1 after:bg-white after:border-gray-300 after:border after:rounded-full after:h-4 after:w-4 after:transition-all peer-checked:after:translate-x-full"></div>
                    </label>
                </div>
                <div class="flex justify-between items-center">
                    <div class="flex items-center">
                        <span class="feature-icon">🎨</span>
                        <span>OPTIMIZE GRAPHICS</span>
                    </div>
                    <label class="relative inline-flex items-center cursor-pointer">
                        <input type="checkbox" class="sr-only peer toggle-feature" data-feature-name="Optimize Graphics">
                        <div class="w-12 h-6 rounded-full peer toggle-switch-bg checked:bg-red-500 peer-focus:ring-2 peer-focus:ring-red-300 after:absolute after:top-1 after:left-1 after:bg-white after:border-gray-300 after:border after:rounded-full after:h-4 after:w-4 after:transition-all peer-checked:after:translate-x-full"></div>
                    </label>
                </div>
                <div class="flex justify-between items-center">
                    <div class="flex items-center">
                        <span class="feature-icon">📈</span>
                        <span>HIGH PERFORMANCE</span>
                    </div>
                    <label class="relative inline-flex items-center cursor-pointer">
                        <input type="checkbox" class="sr-only peer toggle-feature" data-feature-name="High Performance">
                        <div class="w-12 h-6 rounded-full peer toggle-switch-bg checked:bg-red-500 peer-focus:ring-2 peer-focus:ring-red-300 after:absolute after:top-1 after:left-1 after:bg-white after:border-gray-300 after:border after:rounded-full after:h-4 after:w-4 after:transition-all peer-checked:after:translate-x-full"></div>
                    </label>
                </div>
            </div>
        </div>
        <button id="close-panel-bottom" class="bg-gray-700 hover:bg-gray-600 text-white font-bold w-full py-3 mt-4 rounded-full transition-colors duration-200">
            Đóng Menu
        </button>
    </div>

    <div class="bottom-nav">
        <button id="nav-home">Trang chủ</button>
        <button id="nav-instructions">Hướng dẫn</button>
        <button id="nav-admin">Liên hệ Admin</button>
    </div>

    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-database.js"></script>
    <script>
        // CẤU HÌNH FIREBASE CỦA BẠN (Lưu ý: Thông tin này vẫn có thể bị lộ)
        const firebaseConfig = {
          apiKey: "AIzaSyBKGCVdZxmyw6VN0b7aYRQnCqpqfWwASXU",
          authDomain: "lllllk-20ede.firebaseapp.com",
          databaseURL: "https://lllllk-20ede-default-rtdb.firebaseio.com",
          projectId: "lllllk-20ede",
          storageBucket: "lllllk-20ede.firebasestorage.app",
          messagingSenderId: "314220235218",
          appId: "1:314220235218:web:679c9a246c314b535f200b",
          measurementId: "G-DM08514Z1N"
        };
        firebase.initializeApp(firebaseConfig);

        const database = firebase.database();
        const validKeysRef = database.ref('validKeys');

        const gameData = {
            freefire: {
                name: "Garena Free Fire",
                deepLink: "freefire://",
                androidFallback: "https://play.google.com/store/apps/details?id=com.dts.freefireth",
                iosFallback: "https://apps.apple.com/us/app/garena-free-fire-anniversary/id1300146617",
                icon: "https://i.postimg.cc/N0LYBt0W/IMG-2291.jpg"
            }
        };

        let isOptimized = false;
        let frames = [];
        let lastUpdateTime = 0;
        let deviceUID;

        const fpsValueElement = document.getElementById('fps-value');
        const mainPanel = document.getElementById('main-panel');
        const keyPanel = document.getElementById('key-panel');
        const closePanelBottomBtn = document.getElementById('close-panel-bottom');
        const navHomeBtn = document.getElementById('nav-home');
        const navInstructionsBtn = document.getElementById('nav-instructions');
        const navAdminBtn = document.getElementById('nav-admin');
        const keyInput = document.getElementById('key-input');
        const submitKeyBtn = document.getElementById('submit-key-button');
        const keyStatusMessage = document.getElementById('key-status-message');
        const keyExpiryInfo = document.getElementById('key-expiry-info');
        const messageBox = document.getElementById('message-box');
        const messageText = document.getElementById('message-text');
        const closeMessageBtn = document.getElementById('close-message');
        const overlay = document.getElementById('overlay');
        const body = document.body;

        // BẮT ĐẦU: CÁC THAY ĐỔI VỀ BẢO MẬT VÀ THIẾT KẾ
        // Chức năng chống xem mã nguồn
        document.addEventListener('contextmenu', event => event.preventDefault());
        document.addEventListener('keydown', event => {
            const forbiddenKeys = [123, 85, 73, 67, 74]; // F12, U, I, C, J
            if (forbiddenKeys.includes(event.keyCode) && (event.ctrlKey || event.shiftKey)) {
                event.preventDefault();
                alert('Không được phép truy cập mã nguồn!');
            }
        });

        // KẾT THÚC: CÁC THAY ĐỔI VỀ BẢO MẬT VÀ THIẾT KẾ

        function showMessage(message, type = 'info') {
            messageText.innerHTML = message;
            messageText.className = 'text-lg mb-4 text-white';
            if (type === 'success') {
                messageText.classList.add('text-green-400');
            } else if (type === 'error') {
                messageText.classList.add('text-red-400');
            }
            messageBox.classList.remove('hidden');
            overlay.classList.remove('hidden');
            setTimeout(() => {
                messageBox.classList.add('show');
            }, 10);
        }

        closeMessageBtn.addEventListener('click', function() {
            messageBox.classList.remove('show');
            setTimeout(() => {
                messageBox.classList.add('hidden');
                overlay.classList.add('hidden');
            }, 300);
        });

        function openGame() {
            const game = gameData.freefire;
            const userAgent = navigator.userAgent || navigator.vendor || window.opera;
            const startTime = Date.now();
            window.location.href = game.deepLink;
            
            setTimeout(() => {
                const elapsedTime = Date.now() - startTime;
                if (elapsedTime < 2000) {
                    if (/android/i.test(userAgent)) {
                        window.location.href = game.androidFallback;
                    } else if (/iPad|iPhone|iPod/.test(userAgent) && !window.MSStream) {
                        window.location.href = game.iosFallback;
                    }
                }
            }, 1500);
            showMessage(`Đã Tối Ưu Thành Công ${game.name}. Vui Lòng Vào Game Trải Nghiệm Và Gửi Feedback Qua Cho Admin`, 'success');
        }
        
        document.getElementById('open-game-button').addEventListener('click', function() {
            const openButton = document.getElementById('open-game-button');
            const buttonText = document.getElementById('button-text');
            const loadingSpinner = document.getElementById('loading-spinner');

            if (!isOptimized) {
                buttonText.textContent = "Đang tối ưu...";
                loadingSpinner.classList.remove('hidden');
                openButton.disabled = true;
                startOptimization();
            } else {
                openGame();
            }
        });

        document.querySelectorAll('.toggle-feature').forEach(toggle => {
            toggle.addEventListener('change', function() {
                const featureName = this.dataset.featureName;
                if (this.checked) {
                    const originalParent = this.parentElement;
                    const loadingSpinner = document.createElement('div');
                    loadingSpinner.className = 'loading-spinner';
                    originalParent.insertBefore(loadingSpinner, this);
                    this.style.display = 'none';

                    setTimeout(() => {
                        showMessage(`Đã kích hoạt thành công tính năng: ${featureName}`, 'success');
                        originalParent.removeChild(loadingSpinner);
                        this.style.display = 'inline-block';
                    }, 1000);
                } else {
                    showMessage(`Đã tắt tính năng: ${featureName}`, 'info');
                }
            });
        });

        function startOptimization() {
            const toggles = document.querySelectorAll('.toggle-feature');
            const openButton = document.getElementById('open-game-button');
            const buttonText = document.getElementById('button-text');
            const loadingSpinner = document.getElementById('loading-spinner');
            
            toggles.forEach((toggle, index) => {
                setTimeout(() => {
                    toggle.checked = true;
                    if (index === toggles.length - 1) {
                         setTimeout(() => {
                            isOptimized = true;
                            loadingSpinner.classList.add('hidden');
                            buttonText.textContent = "Mở Garena Free Fire";
                            openButton.disabled = false;
                            showMessage("Đã tối ưu xong", 'success');
                            
                            setTimeout(() => {
                                openGame();
                            }, 1000);
                        }, 500);
                    }
                }, 200 + index * 100);
            });
        }

        function getDeviceUID() {
            let uid = localStorage.getItem('device_uid');
            if (!uid) {
                uid = 'UID-' + Math.random().toString(16).substr(2, 8).toUpperCase();
                localStorage.setItem('device_uid', uid);
            }
            return uid;
        }

        function updateDeviceInfo() {
            const deviceInfoElement = document.getElementById('device-info');
            const uidInfoElement = document.getElementById('uid-info');
            const batteryInfoElement = document.getElementById('battery-info');

            let deviceType = "Không xác định";
            const userAgent = navigator.userAgent;
            if (/Android/.test(userAgent)) {
                deviceType = "Android";
            } else if (/iPhone|iPad|iPod/.test(userAgent)) {
                deviceType = "iOS";
            } else if (/Windows/.test(userAgent)) {
                deviceType = "Windows";
            } else if (/Macintosh/.test(userAgent)) {
                deviceType = "Mac";
            }

            deviceUID = getDeviceUID();

            if ('getBattery' in navigator) {
                navigator.getBattery().then(function(battery) {
                    const batteryLevel = Math.round(battery.level * 100) + '%';
                    batteryInfoElement.textContent = batteryLevel;
                }).catch(() => {
                    batteryInfoElement.textContent = "Không có";
                });
            } else {
                batteryInfoElement.textContent = "Không có";
            }

            deviceInfoElement.textContent = deviceType;
            uidInfoElement.textContent = deviceUID;
        }

        function updateFpsCounter(now) {
            frames.push(now);
            while (frames.length > 0 && frames[0] <= now - 1000) {
                frames.shift();
            }

            if (now - lastUpdateTime > 100) {
                const fps = frames.length;
                fpsValueElement.textContent = fps;
                lastUpdateTime = now;
            }
            
            requestAnimationFrame(updateFpsCounter);
        }

        function updateKeyExpiry() {
            const storedExpiry = localStorage.getItem('key_expiry');
            if (storedExpiry) {
                const now = Date.now();
                const timeLeft = storedExpiry - now;
                
                if (timeLeft <= 0) {
                    localStorage.removeItem('valid_key');
                    localStorage.removeItem('key_expiry');
                    keyPanel.classList.remove('hidden');
                    mainPanel.classList.add('hidden');
                    showMessage("Key của bạn đã hết hạn. Vui lòng nhập key mới.", 'error');
                    return;
                }

                const days = Math.floor(timeLeft / (1000 * 60 * 60 * 24));
                const hours = Math.floor((timeLeft % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
                const minutes = Math.floor((timeLeft % (1000 * 60 * 60)) / (1000 * 60));
                const seconds = Math.floor((timeLeft % (1000 * 60)) / 1000);

                if (days > 0) {
                    keyExpiryInfo.textContent = `${days} ngày ${hours}h`;
                } else if (hours > 0) {
                    keyExpiryInfo.textContent = `${hours}h ${minutes}m`;
                } else {
                    keyExpiryInfo.textContent = `${minutes}m ${seconds}s`;
                }
            } else {
                keyExpiryInfo.textContent = 'Key hết hạn';
            }
        }

        setInterval(updateKeyExpiry, 1000);

        closePanelBottomBtn.addEventListener('click', () => {
            mainPanel.classList.add('menu-closed');
        });

        navHomeBtn.addEventListener('click', () => {
            mainPanel.classList.remove('menu-closed');
            document.getElementById('message-box').classList.add('hidden');
        });

        navInstructionsBtn.addEventListener('click', () => {
            const instructionsText = `
                <span class="text-white text-lg font-bold mb-4">HƯỚNG DẪN SỬ DỤNG</span><br><br>
                1. LIÊN HỆ ADMIN LẤY KEY KÍCH HOẠT<br>
                2. NHẬP KEY VÀO Ô ĐỂ MỞ MENU<br>
                3. BẤM "TỐI ƯU" ĐỂ TỰ ĐỘNG KÍCH HOẠT CÁC CHỨC NĂNG 
            `;
            showMessage(instructionsText);
        });

        navAdminBtn.addEventListener('click', () => {
            window.location.href = 'https://linkbio.co/anhquan1';
        });

        submitKeyBtn.addEventListener('click', () => {
            const enteredKey = keyInput.value.trim();
            if (enteredKey === "") {
                keyStatusMessage.textContent = "Vui lòng nhập key!";
                keyStatusMessage.className = "text-center text-sm mt-2 status-error";
                return;
            }
            
            const buttonText = document.getElementById('key-button-text');
            const loadingSpinner = document.getElementById('key-loading-spinner');
            
            buttonText.textContent = "Đang kiểm tra...";
            loadingSpinner.classList.remove('hidden');
            submitKeyBtn.disabled = true;

            validKeysRef.child(enteredKey).once('value').then(snapshot => {
                loadingSpinner.classList.add('hidden');
                submitKeyBtn.disabled = false;
                buttonText.textContent = "Kích hoạt";

                const keyData = snapshot.val();
                const now = Date.now();
                const currentDeviceUID = getDeviceUID();

                if (!keyData) {
                    keyStatusMessage.textContent = "Key không hợp lệ hoặc đã hết hạn.";
                    keyStatusMessage.className = "text-center text-sm mt-2 status-error";
                } else if (keyData.expiry <= now) {
                    keyStatusMessage.textContent = "Key đã hết hạn.";
                    keyStatusMessage.className = "text-center text-sm mt-2 status-error";
                    validKeysRef.child(enteredKey).remove();
                } else if (keyData.uid && keyData.uid !== currentDeviceUID) {
                    keyStatusMessage.textContent = "Key này đã được sử dụng trên một thiết bị khác.";
                    keyStatusMessage.className = "text-center text-sm mt-2 status-error";
                } else {
                    validKeysRef.child(enteredKey).update({
                        used: true,
                        uid: currentDeviceUID
                    });

                    keyStatusMessage.textContent = "Key hợp lệ! Đang mở menu chính...";
                    keyStatusMessage.className = "text-center text-sm mt-2 status-success";
                    localStorage.setItem('valid_key', enteredKey);
                    localStorage.setItem('key_expiry', keyData.expiry);

                    setTimeout(() => {
                        keyPanel.classList.add('hidden');
                        mainPanel.classList.remove('hidden');
                        showMessage("Chào mừng đến với NARUTO SHIPPUDEN!", 'success');
                        updateDeviceInfo();
                        requestAnimationFrame(updateFpsCounter);
                        updateKeyExpiry();
                    }, 1000);
                }
            }).catch(error => {
                loadingSpinner.classList.add('hidden');
                submitKeyBtn.disabled = false;
                buttonText.textContent = "Kích hoạt";
                keyStatusMessage.textContent = "Lỗi kết nối. Vui lòng thử lại.";
                keyStatusMessage.className = "text-center text-sm mt-2 status-error";
                console.error("Firebase error: ", error);
            });
        });

        function checkKeyOnLoad() {
            updateDeviceInfo();
            const storedKey = localStorage.getItem('valid_key');
            if (storedKey) {
                validKeysRef.child(storedKey).once('value').then(snapshot => {
                    const keyData = snapshot.val();
                    const now = Date.now();
                    const currentDeviceUID = getDeviceUID();

                    if (keyData && keyData.uid === currentDeviceUID && keyData.expiry > now) {
                        keyPanel.classList.add('hidden');
                        mainPanel.classList.remove('hidden');
                        requestAnimationFrame(updateFpsCounter);
                        updateKeyExpiry();
                        showMessage("Chào mừng quay trở lại!", 'success');
                    } else {
                        localStorage.removeItem('valid_key');
                        localStorage.removeItem('key_expiry');
                        keyPanel.classList.remove('hidden');
                        mainPanel.classList.add('hidden');
                        if (keyData && keyData.expiry <= now) {
                            validKeysRef.child(storedKey).remove();
                            showMessage("Key của bạn đã hết hạn.", 'error');
                        } else {
                            showMessage("Vui lòng nhập key để truy cập.", 'info');
                        }
                    }
                });
            } else {
                keyPanel.classList.remove('hidden');
                mainPanel.classList.add('hidden');
                showMessage("Vui lòng nhập key để truy cập.", 'info');
            }
        }

        window.onload = checkKeyOnLoad;
    </script>
</body>
</html>
